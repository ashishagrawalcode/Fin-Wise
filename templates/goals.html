<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goals | FinWise</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=35">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body style="background-color: #F8FAFC;">

    <header>
        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="FinWise" style="height: 40px;">
            FinWise
        </div>
        <nav>
            <ul>
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/accounts">Accounts</a></li>
                <li><a href="/simulations">Simulations</a></li>
                <li><a href="/lessons">Lessons</a></li>
                <li><a href="/goals" style="color: var(--primary);">Goals</a></li>
                <li><a href="/leaderboard">Leaderboard</a></li>
                <li><a href="/profile">Profile</a></li>
            </ul>
        </nav>
        <div class="nav-actions">
            <button onclick="openModal('addGoalModal')" class="btn-primary" style="padding: 8px 20px; font-size: 0.9rem;">
                <i class="fa-solid fa-plus"></i> New Goal
            </button>
            <a href="/logout" style="color:#ef4444; margin-left:10px;"><i class="fa-solid fa-power-off"></i></a>
        </div>
    </header>

    <div class="dashboard-container">
        
        <div class="goals-header-card">
            <div class="goals-header-content">
                <h1 style="margin-bottom: 10px;">Your Dreams, Funding... ðŸš€</h1>
                <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 20px;">You have saved <b>{{ total_saved }}</b> towards your life goals.</p>
                
                <div style="width: 300px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.9rem; margin-bottom:5px;">
                        <span>Overall Progress</span>
                        <span>{{ progress_pct }}%</span>
                    </div>
                    <div style="height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px;">
                        <div style="height: 100%; width: {{ progress_pct }}%; background: white; border-radius: 4px;"></div>
                    </div>
                </div>
            </div>
            <i class="fa-solid fa-bullseye goals-bg-icon"></i>
        </div>

        <div class="goals-grid">
            
            {% for goal in goals %}
            <div class="goal-card">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div class="goal-icon-box cat-{{ goal.category }}">
                        {% if goal.category == 'house' %}<i class="fa-solid fa-house"></i>
                        {% elif goal.category == 'car' %}<i class="fa-solid fa-car"></i>
                        {% elif goal.category == 'travel' %}<i class="fa-solid fa-plane"></i>
                        {% elif goal.category == 'emergency' %}<i class="fa-solid fa-briefcase-medical"></i>
                        {% else %}<i class="fa-solid fa-star"></i>{% endif %}
                    </div>
                    <span class="priority-badge p-{{ goal.priority }}">{{ goal.priority }}</span>
                </div>

                <div class="goal-title">{{ goal.title }}</div>
                <div class="goal-meta">Target: {{ goal.deadline }}</div>

                <div class="goal-progress-track">
                    <div class="goal-progress-fill" style="width: {{ (goal.current_amount / goal.target_amount * 100)|round }}%;"></div>
                </div>
                <div class="goal-amounts">
                    <span style="color:var(--primary);">â‚¹{{ goal.current_amount }}</span>
                    <span style="color:var(--text-muted);">â‚¹{{ goal.target_amount }}</span>
                </div>

                <form method="POST" class="add-funds-overlay">
                    <input type="hidden" name="update_goal_id" value="{{ goal.id }}">
                    <input type="number" name="add_amount" class="input-mini" placeholder="+ Add Funds" required>
                    <button type="submit" class="btn-mini-add" onclick="confettiEffect()">Add</button>
                </form>

                <form method="POST" style="position:absolute; bottom:20px; right:20px;">
                    <input type="hidden" name="delete_goal_id" value="{{ goal.id }}">
                    <button type="submit" onclick="return confirm('Delete this goal?')" style="background:none; border:none; color:#CBD5E1; cursor:pointer;"><i class="fa-solid fa-trash"></i></button>
                </form>

            </div>
            {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 60px; background: white; border-radius: 20px; border: 1px dashed #CBD5E1;">
                <i class="fa-solid fa-mountain-sun" style="font-size: 3rem; color: #CBD5E1; margin-bottom: 15px;"></i>
                <h3>No goals yet</h3>
                <p style="color:var(--text-muted); margin-bottom: 20px;">Start by setting your first financial target.</p>
                <button onclick="openModal('addGoalModal')" class="btn-primary">Set a Goal</button>
            </div>
            {% endfor %}

        </div>
        
        <div class="tips-container">
            <h3><i class="fa-solid fa-wand-magic-sparkles"></i> FinWise Insights</h3>
            <ul style="list-style: none; padding: 0;">
                <li>â€¢ <b>Emergency Fund:</b> This should always be your #1 priority (High).</li>
                <li>â€¢ <b>Inflation:</b> Remember that â‚¹1L for a trip in 5 years might cost â‚¹1.3L then.</li>
                <li>â€¢ <b>Consistent Savings:</b> Adding small amounts monthly beats waiting for a lump sum.</li>
            </ul>
        </div>

        <div style="height: 50px;"></div>
    </div>

    <div id="addGoalModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center;">
        <div class="modal-content" style="background:white; padding:30px; border-radius:20px; width:90%; max-width:500px;">
            <span onclick="closeModal('addGoalModal')" style="float:right; cursor:pointer; font-size:1.5rem;">&times;</span>
            <h2 style="margin-bottom: 20px;">Create New Goal ðŸŽ¯</h2>
            
            <form method="POST">
                <div class="form-group">
                    <label>Goal Title</label>
                    <input type="text" name="title" placeholder="e.g. Dream House" required style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                </div>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Category</label>
                        <select name="category" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                            <option value="emergency">Emergency Fund</option>
                            <option value="house">House / Property</option>
                            <option value="car">Car / Bike</option>
                            <option value="travel">Travel / Vacation</option>
                            <option value="tech">Gadgets / Tech</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select name="priority" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                            <option value="High">High ðŸ”¥</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Target Amount (â‚¹)</label>
                        <input type="number" name="target_amount" placeholder="500000" required style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                    </div>
                    <div class="form-group">
                        <label>Saved So Far (â‚¹)</label>
                        <input type="number" name="current_amount" value="0" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                    </div>
                </div>

                <div class="form-group">
                    <label>Target Date</label>
                    <input type="date" name="deadline" required style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
                </div>

                <button type="submit" class="btn-primary" style="width:100%; margin-top: 10px;">Create Goal</button>
            </form>
        </div>
    </div>

    <script>
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // Confetti for fun interaction
        function confettiEffect() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>